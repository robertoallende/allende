# Unit 08_email_001: SNS Email Notification Setup

## Objective
Set up AWS Simple Notification Service (SNS) to receive email notifications when users submit contact forms through the conversational email flow, establishing the foundation for the backend email processing system.

## Problem Analysis

### Current State
- **Frontend email flow**: Complete conversational system collecting user messages and emails
- **Mock backend**: Console.log statements simulating email sending
- **No notifications**: Roberto has no way to receive actual contact form submissions
- **Missing infrastructure**: No AWS backend services configured

### Desired State
- **SNS topic**: Dedicated notification channel for contact form submissions
- **Email subscription**: Roberto receives formatted email notifications
- **Test validation**: Confirmed working notification system
- **Integration ready**: Topic ARN available for Lambda function integration

## Technical Specification

### SNS Topic Configuration
- **Topic Name**: `contact-form-notifications`
- **Topic Type**: Standard (handles multiple messages, order doesn't matter for notifications)
- **Purpose**: Receive contact form submissions and distribute to email subscribers
- **Region**: Match existing Amplify deployment region

### Email Notification Format
```
Subject: Contact Form: [User Name]

Contact Form Submission

Name: [User Name]
Email: [User Email]

Message:
[User Message]

Submitted: [Timestamp]
Verification: Passed
```

### Subscription Configuration
- **Protocol**: Email
- **Endpoint**: Roberto's email address
- **Confirmation**: Required email confirmation step
- **Delivery**: Immediate notification on message publish

## Implementation Steps

### Step 1: Navigate to SNS Service
- Access AWS Console
- Search for "SNS" service
- Navigate to Simple Notification Service dashboard
- Ensure correct region is selected (match Amplify deployment)

### Step 2: Create SNS Topic
- Click "Create topic"
- **Topic type**: Standard
- **Name**: `contact-form-notifications`
- **Display name**: Contact Form Notifications
- **Description**: Notifications for website contact form submissions
- Leave other settings as default
- Click "Create topic"

### Step 3: Configure Topic Settings
- **Access policy**: Default (topic owner has full access)
- **Delivery retry policy**: Default AWS retry settings
- **Delivery status logging**: Optional (can enable for debugging)
- **Encryption**: Not required for contact form notifications

### Step 4: Create Email Subscription
- In the topic details, click "Create subscription"
- **Protocol**: Email
- **Endpoint**: Roberto's email address
- **Filter policy**: None (receive all messages)
- Click "Create subscription"

### Step 5: Confirm Email Subscription
- Check Roberto's email inbox
- Look for AWS SNS confirmation email
- Click "Confirm subscription" link in email
- Verify subscription status shows "Confirmed" in AWS console

### Step 6: Test Notification System
- In SNS topic, click "Publish message"
- **Subject**: Test Contact Form Notification
- **Message**: 
```
Contact Form Submission

Name: Test User
Email: test@example.com

Message:
This is a test message to verify the notification system is working correctly.

Submitted: 2025-08-25T06:55:13.673Z
Verification: Passed
```
- Click "Publish message"
- Verify email is received within 30 seconds

### Step 7: Document Configuration
- **Copy Topic ARN**: Save the full ARN (arn:aws:sns:region:account:contact-form-notifications)
- **Verify region**: Confirm topic is in correct region for Amplify integration
- **Test delivery**: Confirm email notifications are working
- **Document settings**: Record configuration for Lambda integration

## Expected Outputs

### SNS Topic
- **Topic ARN**: `arn:aws:sns:us-east-1:123456789012:contact-form-notifications`
- **Status**: Active and ready to receive messages
- **Subscriptions**: 1 confirmed email subscription

### Email Subscription
- **Status**: Confirmed
- **Protocol**: Email
- **Endpoint**: Roberto's email address
- **Delivery**: Immediate notification on publish

### Test Validation
- **Test message sent**: Successfully published to topic
- **Email received**: Notification delivered to Roberto's inbox
- **Format verified**: Message format matches expected structure
- **Timing confirmed**: Delivery within 30 seconds

## Integration Preparation

### For Lambda Function (Unit 8.3)
```python
# Topic ARN to be used in Lambda function
TOPIC_ARN = 'arn:aws:sns:us-east-1:123456789012:contact-form-notifications'

# SNS client initialization
import boto3
sns = boto3.client('sns')

# Message publishing (preview)
sns.publish(
    TopicArn=TOPIC_ARN,
    Subject=f'Contact Form: {user_name}',
    Message=formatted_message
)
```

### For IAM Policy (Unit 8.2)
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "sns:Publish",
            "Resource": "arn:aws:sns:us-east-1:123456789012:contact-form-notifications"
        }
    ]
}
```

## Troubleshooting Guide

### Common Issues

#### Email Not Received
- **Check spam folder**: AWS emails sometimes filtered as spam
- **Verify subscription**: Ensure subscription status is "Confirmed"
- **Check email address**: Verify correct email in subscription endpoint
- **Region mismatch**: Ensure SNS topic in correct AWS region

#### Subscription Not Confirming
- **Email delay**: Confirmation emails can take up to 5 minutes
- **Check all folders**: Look in spam, promotions, updates folders
- **Resend confirmation**: Delete and recreate subscription if needed
- **Email provider issues**: Some providers block AWS emails

#### Topic Creation Fails
- **Permissions**: Ensure AWS user has SNS permissions
- **Name conflicts**: Topic names must be unique in region/account
- **Region selection**: Verify correct region is selected
- **Service limits**: Check AWS service limits for SNS topics

### Validation Checklist
- [ ] SNS topic created successfully
- [ ] Topic ARN copied and documented
- [ ] Email subscription created
- [ ] Subscription confirmation completed
- [ ] Test message published successfully
- [ ] Email notification received
- [ ] Message format verified
- [ ] Topic ready for Lambda integration

## Success Criteria

1. ✅ **SNS Topic Created**: `contact-form-notifications` topic active and configured
2. ✅ **Email Subscription Confirmed**: Roberto's email successfully subscribed and confirmed
3. ✅ **Test Notification Sent**: Test message published and email received
4. ✅ **Topic ARN Documented**: ARN saved for Lambda function integration
5. ✅ **Delivery Verified**: Email notifications working within 30 seconds
6. ✅ **Format Validated**: Message format matches contact form requirements

## Next Steps

### Immediate
- **Document Topic ARN**: Save for Unit 8.2 IAM policy creation
- **Verify email delivery**: Ensure notifications are reliable
- **Test message format**: Confirm email format meets requirements

### Unit 8.2 Preparation
- **Topic ARN**: Required for IAM policy resource specification
- **Region confirmation**: Ensure Lambda function will be in same region
- **Permission planning**: Understand SNS publish requirements for Lambda

## Files to Update

### Documentation
- `dev_log/08_email_001.md` - This implementation log
- `dev_log/08_email_backend.md` - Update with Topic ARN
- Configuration notes for Lambda integration

### No Code Changes
This unit focuses purely on AWS infrastructure setup with no frontend or backend code modifications.

## Status: Planned

This unit establishes the notification foundation for the entire email backend system. Once completed, Roberto will be able to receive email notifications, and the infrastructure will be ready for Lambda function integration in subsequent units.

The SNS topic serves as the central hub for all contact form notifications, providing a scalable, reliable way to deliver user messages to Roberto while maintaining separation between the processing logic (Lambda) and notification delivery (SNS).
