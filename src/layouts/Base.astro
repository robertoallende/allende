---
interface Props {
  title?: string;
  description?: string;
  image?: string;
}

import Themes from "astro-themes";
// import { ViewTransitions } from "astro:transitions";

import BaseHead from "../components/BaseHead.astro";
import Navbar from "../components/Nav.astro";
import Footer from "../components/Footer.astro";

import "@fontsource/geist-sans/400.css";
import "@fontsource/geist-sans/600.css";
import "@fontsource/geist-mono/400.css";
import "@fontsource/geist-mono/600.css";
import "@styles/global.css";
import "../assets/styles/typewriter.css";

const { title, description, image } = Astro.props;
---

<html lang="en" class="scrollbar-hide lenis lenis-smooth">
  <head>
    <!-- <ViewTransitions /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="googlebot"
      content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"
    />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <Themes />
    <BaseHead title={title} description={description} image={image} />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Your Site's Title"
      href={new URL("rss.xml", Astro.site)}
    />
    <script>
      import "@scripts/lenisSmoothScroll.js";
    </script>
  </head>
  <body
    class="antialiased flex flex-col items-center justify-center mx-auto mt-2 lg:mt-8 mb-20 lg:mb-40
    scrollbar-hide">
    <main
      class="flex-auto min-w-0 mt-2 md:mt-6 flex flex-col px-6 sm:px-4 md:px-0 max-w-[640px] w-full">
      <Navbar />
      <slot />
      <Footer />
    </main>
    
    <script>
      // Typewriter Animation Controller
      class TypewriterEffect {
        constructor(element, options = {}) {
          this.element = element;
          this.text = element.textContent;
          this.speed = options.speed || 50;
          this.delay = options.delay || 0;
          this.cursor = options.cursor !== false;
          
          // Clear the element and start animation
          this.element.textContent = '';
          this.element.classList.add('typewriter');
          
          if (this.delay > 0) {
            setTimeout(() => this.start(), this.delay);
          } else {
            this.start();
          }
        }
        
        start() {
          let i = 0;
          const type = () => {
            if (i < this.text.length) {
              this.element.textContent += this.text.charAt(i);
              i++;
              setTimeout(type, this.speed);
            } else {
              // Animation complete
              this.element.classList.add('complete');
              this.element.classList.remove('typing');
              if (!this.cursor) {
                this.element.classList.remove('typewriter');
              }
            }
          };
          
          this.element.classList.add('typing');
          type();
        }
      }

      // Auto-initialize on page load and navigation
      function initTypewriter() {
        // Initialize typewriter effects
        document.querySelectorAll('[data-typewriter]').forEach((element, index) => {
          // Skip if already processed
          if (element.classList.contains('typewriter-processed')) return;
          
          const speed = parseInt(element.dataset.speed) || 50;
          const delay = parseInt(element.dataset.delay) || index * 1000;
          const cursor = element.dataset.cursor !== 'false';
          
          element.classList.add('typewriter-processed');
          new TypewriterEffect(element, { speed, delay, cursor });
        });
      }

      document.addEventListener('DOMContentLoaded', initTypewriter);
      
      // Also run on page navigation (for SPA-like behavior)
      document.addEventListener('astro:page-load', initTypewriter);

      // Respect user motion preferences
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        document.addEventListener('DOMContentLoaded', () => {
          // Skip animations for users who prefer reduced motion
          document.querySelectorAll('[data-typewriter]').forEach(element => {
            element.classList.remove('typewriter');
          });
        });
      }
    </script>
    
    <style>
      /* CSS rules for the page scrollbar */
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }

      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
  </body>
</html>
