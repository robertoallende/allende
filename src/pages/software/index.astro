---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';
import { fetchAwsBuilderContent } from '../../utils/aws-builder-fetcher.js';

// Get portfolio content
const portfolioContent = await getCollection('portfolio');
const softwareContent = portfolioContent.find(entry => entry.data.section === 'software');

if (!softwareContent) {
  throw new Error('Software content not found');
}

// Fetch AWS Builder content at build time
const awsBuilderFeed = await fetchAwsBuilderContent();

const { Content } = await softwareContent.render();
---

<Base title={softwareContent.data.title} description={softwareContent.data.description}>
  <main class="mx-auto max-w-4xl px-6 py-12">
    <!-- Page Title -->
    <h1 class="text-4xl font-bold mb-8">{softwareContent.data.title}</h1>
    
    <!-- Existing autogenerated content -->
    <Content />
    
    <!-- RSS Feed Content -->
    <section class="mt-12 border-t border-gray-200 dark:border-gray-700 pt-8">
      <div class="space-y-6">
        {awsBuilderFeed.map((item) => (
          <article class="pb-6">
            <h3 class="text-lg font-medium mb-2">
              <a 
                href={item.link} 
                target="_blank" 
                rel="noopener noreferrer"
                class="text-blue-600 dark:text-blue-400 hover:underline"
              >
                {item.title}
              </a>
            </h3>
            {item.description && (
              <p class="text-gray-600 dark:text-gray-300 mb-2 leading-relaxed">
                {item.description}
              </p>
            )}
            {item.date && (
              <time class="text-sm text-gray-500 dark:text-gray-400">
                {item.date.toLocaleDateString('en-US', { 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric' 
                })}
              </time>
            )}
          </article>
        ))}
      </div>
      
      <!-- Link to all articles -->
      <div class="mt-8 pt-6 border-t border-gray-100 dark:border-gray-800">
        <p class="text-sm text-gray-600 dark:text-gray-400 italic">
          Read all the articles at <a 
            href="https://builder.aws.com/community/@robertoallende" 
            target="_blank" 
            rel="noopener noreferrer"
            class="text-blue-600 dark:text-blue-400 hover:underline"
          >AWS Builder Center</a>
        </p>
      </div>
    </section>
  </main>
</Base>
