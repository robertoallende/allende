---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';
import { fetchRSSFeed, RSS_FEEDS } from '../../utils/rss-fetcher.js';

// Get portfolio content
const portfolioContent = await getCollection('portfolio');
const footballContent = portfolioContent.find(entry => entry.data.section === 'football');

if (!footballContent) {
  throw new Error('Football content not found');
}

// Fetch RSS feed at build time
const rssFeed = await fetchRSSFeed(RSS_FEEDS.football);

const { Content } = await footballContent.render();
---

<Base title={footballContent.data.title} description={footballContent.data.description}>
  <main class="mx-auto max-w-4xl px-6 py-12">
    <!-- Page Title -->
    <h1 class="text-4xl font-bold mb-8">{footballContent.data.title}</h1>
    
    <!-- Existing autogenerated content -->
    <Content />
    
    <!-- RSS Feed Content -->
    <section class="mt-12 border-t border-gray-200 dark:border-gray-700 pt-8">
      <div class="space-y-6">
        {rssFeed.map((item) => (
          <article class="pb-6">
            <h3 class="text-lg font-medium mb-2 flex items-baseline justify-between">
              <a 
                href={item.link} 
                target="_blank" 
                rel="noopener noreferrer"
                class="text-blue-600 dark:text-blue-400 hover:underline"
              >
                {item.title}
              </a>
              {item.pubDate && (
                <time class="text-sm text-gray-400 dark:text-gray-500 ml-4 flex-shrink-0">
                  {item.pubDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                  })}
                </time>
              )}
            </h3>
            {item.description && (
              <p class="text-gray-600 dark:text-gray-300 mb-2 leading-relaxed">
                {item.description}
              </p>
            )}
          </article>
        ))}
      </div>
      
      <!-- Link to all articles -->
      <div class="mt-8 pt-6 border-t border-gray-100 dark:border-gray-800">
        <p class="text-sm text-gray-600 dark:text-gray-400 italic">
          Read all the articles at <a 
            href="https://en.allende.nz/football" 
            target="_blank" 
            rel="noopener noreferrer"
            class="text-blue-600 dark:text-blue-400 hover:underline"
          >Football Notes</a>
        </p>
      </div>
    </section>
  </main>
</Base>
